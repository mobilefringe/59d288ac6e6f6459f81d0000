<div class="content_container main_container padding_top_40">
    <!--<div class="promo_main_header">-->
    <!--    EVENTS-->
    <!--</div>-->
    <div class="row">
        <div class="col-md-8">
            <div id="promos_container">
                <script id="promos_template" type="x-tmpl-mustache/text">
                    <div class="row promo_item cats_row" data-cat="{{cat_list}}">
                        <div class="col-md-5 text-center">
                            <img src="{{logo_url}}" alt="{{name}}" class="actual_width" />
                        </div>
                        <div class="col-md-7">
                            <h2 class="promo_list_name"><a class="hover_underline" href="/events/{{slug}}">{{name}}</a></h2>
                            <p>
                                <span class="promo_dates">{{dates}}</span>
                            </p>
                            <div class="promo_list_desc">{{description_short}}</div>
                            <a class="read_more" href="/events/{{slug}}">Read More</a>
                        </div>
                    </div>
                </script>
            </div>
            <div class="row promo_item cats_row promo_list_desc" id="no_promos">
                No events available at this moment. Please check back later!
            </div>
        </div>
        
        <div class="col-md-4 hidden_phone">
        </div> 
    </div>
</div>
<div class="content_container main_container padding-top-40">
    <h4 class="promo_main_header">Contest</h4>
    <div class="row padding_20">
        <div class="col-md-12">
            <div id="contest_container">
                <script id="contest_template" type="x-tmpl-mustache/text">
                    <img alt="contest image" class="details_image" src="{{alt_photo_url}}" />
                    <p class="promo_list_name">{{name}}</p>
                    <div class="details_desc">{{{description}}}</div>
                    <form id="contest_form">
                        <input id="property_id" name="contest[property_id]" type="hidden" value="{{property_id}}"/>
                        <input id="contest_id" name="contest[contest_id]" type="hidden"  value="{{id}}" />
                        <input type="hidden" name="cm-name" id="cm-name" />
                        <div class="row">
                            <div class="col-md-6">
                                <label for="first_name">First Name *</label>  
                                <input class="form-control" id="first_name" name="contest[first_name]" type="text" required />
                            </div>
                            <div class="col-md-6">
                                <label for="last_name">Last Name *</label>  
                                <input class="form-control" id="last_name" name="contest[last_name]" type="text" required />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="email">Email *</label> 
                                <input class="form-control" id="email" name="contest[email]" type="email" required />
                            </div>
                            <div class="col-md-6">
                                <label for="phone_number">Phone Number</label>  
                                <input class="form-control" id="phone_number" name="contest[phone]" type="text"  />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>
                                    <input type="checkbox" id="agree_terms" /> I agree with <a class="blue" href="#" target="_blank">Terms and Conditions</a>
                                </label>
                                <label>
                                    <input type="checkbox" id="add_to_newsletter" name="contest[newsletter]" /> Yes, subscribe me to your email list to receive promotions and events!
                                </label>
                                <button type="submit" class="newsletter_btn animated_btn" id="submit_btn">Submit</button>
                                <p id="success_subscribe" class="hidden_now">Thank you for entering in the contest</p>
                            </div>
                        </div>
                    </form>
                </script>
            </div>
            
        </div>
        
    </div>
</div>
<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderAll); 
    })
    
    function renderAll(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        var contestDetails = getContestBySlug(slug);
        if(contestDetails != undefined){
            renderContest('#contest_container','#contest_template', contestDetails);
        }
        else{
            $('#contest_ended').show();
        }
        show_content();
        $('#contest_form').submit(function(e){
            e.preventDefault();
            if ($("#agree_terms").prop("checked") != true){
                alert("Please agree with Terms and Conditions to continue.");
                $("#agree_terms").focus();
                return false;
            }
            else{
                $('#submit_btn').prop( "disabled", true );
                submit_contest($(this).serialize());
                if ($("#add_to_newsletter").prop("checked")){
                    var form_data = {};
                    form_data['cm-name'] = $("#first_name").val() + " " + $("#last_name").val();
                    form_data[site_json.newsletter_email_field] = $('#email').val();
                    $.getJSON(site_json.newsletter_form_url, form_data);
                }
            }
            
        })
    }
</script>